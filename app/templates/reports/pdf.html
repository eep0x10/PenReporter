<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8"/>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;700&display=swap');

  :root {
    --bg: #ffffff;
    --surface: #f5f5f5;
    --border: #d0d0d0;
    --text: #1a1a1a;
    --muted: #666666;
    --accent: #0066cc;
    --critical: #d1242f;
    --high: #ff6b35;
    --medium: #ffa500;
    --low: #0066cc;
    --info: #666666;
    --green: #2da44e;
  }

  * { margin: 0; padding: 0; box-sizing: border-box; }

  body {
    font-family: 'Inter', sans-serif;
    background: var(--bg);
    color: var(--text);
    font-size: 11pt;
    line-height: 1.6;
  }

  /* Cover Page */
  .cover {
    page-break-after: always;
    min-height: 100vh;
    background: linear-gradient(135deg, #ffffff 0%, #f5f5f5 50%, #ffffff 100%);
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding: 80px 60px;
    position: relative;
    overflow: hidden;
  }

  .cover::before {
    content: '';
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    background: radial-gradient(ellipse at 20% 50%, rgba(0,102,204,.04) 0%, transparent 60%),
                radial-gradient(ellipse at 80% 20%, rgba(100,120,200,.03) 0%, transparent 50%);
  }

  .cover-accent-line {
    width: 60px;
    height: 4px;
    background: linear-gradient(90deg, #0066cc, #6476c8);
    border-radius: 2px;
    margin-bottom: 32px;
  }

  .cover-label {
    font-size: 11pt;
    color: var(--accent);
    text-transform: uppercase;
    letter-spacing: 4px;
    font-weight: 500;
    margin-bottom: 16px;
  }

  .cover-title {
    font-size: 32pt;
    font-weight: 700;
    color: #000000;
    line-height: 1.2;
    margin-bottom: 24px;
    max-width: 600px;
  }

  .cover-client {
    font-size: 16pt;
    color: var(--muted);
    margin-bottom: 48px;
  }

  .cover-meta {
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-bottom: 60px;
  }

  .cover-meta-item {
    display: flex;
    gap: 16px;
  }

  .cover-meta-label {
    color: var(--muted);
    font-size: 10pt;
    width: 120px;
    flex-shrink: 0;
  }

  .cover-meta-value {
    color: var(--text);
    font-size: 10pt;
    font-weight: 500;
  }

  .cover-confidential {
    position: absolute;
    top: 40px;
    right: 60px;
    border: 1px solid rgba(209,36,47,.6);
    color: #d1242f;
    padding: 6px 16px;
    font-size: 9pt;
    text-transform: uppercase;
    letter-spacing: 2px;
    font-weight: 600;
  }

  .cover-risk-badge {
    display: inline-block;
    padding: 8px 20px;
    border-radius: 4px;
    font-size: 12pt;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 2px;
  }

  .risk-critical { background: rgba(209,36,47,.1); color: #d1242f; border: 1px solid rgba(209,36,47,.4); }
  .risk-high { background: rgba(255,107,53,.1); color: #ff6b35; border: 1px solid rgba(255,107,53,.4); }
  .risk-medium { background: rgba(255,165,0,.1); color: #ffa500; border: 1px solid rgba(255,165,0,.4); }
  .risk-low { background: rgba(0,102,204,.1); color: #0066cc; border: 1px solid rgba(0,102,204,.4); }

  /* Content pages */
  .page { padding: 50px 60px; page-break-before: avoid; margin: 0; }

  .section-title {
    font-size: 18pt;
    font-weight: 700;
    color: #000000;
    margin-bottom: 16px;
    margin-top: 0;
    padding-bottom: 14px;
    border-bottom: 2px solid var(--border);
    display: flex;
    align-items: center;
    gap: 10px;
    page-break-after: avoid;
  }

  .section-accent {
    width: 4px;
    height: 24px;
    background: linear-gradient(180deg, #0066cc, #6476c8);
    border-radius: 2px;
    flex-shrink: 0;
  }

  h2 { font-size: 14pt; font-weight: 600; color: #000000; margin: 28px 0 14px; page-break-after: avoid; }
  h3 { font-size: 11pt; font-weight: 600; color: #000000; margin: 18px 0 10px; page-break-after: avoid; }
  p { margin-bottom: 14px; color: var(--text); line-height: 1.6; }
  pre, code { font-family: 'JetBrains Mono', monospace; font-size: 9pt; }

  .text-muted { color: var(--muted); }

  /* Findings Summary Table */
  .findings-table {
    width: 100%;
    border-collapse: collapse;
    margin-bottom: 28px;
    font-size: 9pt;
    page-break-inside: avoid;
  }

  .findings-table th {
    background: #f5f5f5;
    color: #666666;
    padding: 12px 14px;
    text-align: left;
    font-weight: 600;
    text-transform: uppercase;
    font-size: 8pt;
    letter-spacing: 1px;
    border: 1px solid var(--border);
  }

  .findings-table td {
    padding: 12px 14px;
    border: 1px solid var(--border);
    color: #1a1a1a;
    vertical-align: middle;
    line-height: 1.5;
  }

  .findings-table tr:nth-child(even) td { background: #fafafa; }

  /* Severity badges */
  .badge {
    display: inline-block;
    padding: 3px 10px;
    border-radius: 3px;
    font-size: 8pt;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .badge-critical { background: rgba(209,36,47,.15); color: #d1242f; }
  .badge-high { background: rgba(255,107,53,.15); color: #ff6b35; }
  .badge-medium { background: rgba(255,165,0,.15); color: #ffa500; }
  .badge-low { background: rgba(0,102,204,.15); color: #0066cc; }
  .badge-informational { background: rgba(100,100,100,.15); color: #666666; }
  .badge-open { background: rgba(209,36,47,.15); color: #d1242f; }
  .badge-remediated { background: rgba(45,164,78,.15); color: #2da44e; }
  .badge-accepted { background: rgba(255,165,0,.15); color: #ffa500; }
  .badge-fp { background: rgba(100,100,100,.15); color: #666666; }

  /* Vuln card */
  .vuln-card {
    background: #f5f5f5;
    border: 1px solid var(--border);
    border-radius: 6px;
    margin-bottom: 24px;
    margin-top: 12px;
    page-break-inside: avoid;
    page-break-after: auto;
  }

  .vuln-card-header {
    padding: 16px 18px;
    border-bottom: 1px solid var(--border);
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    gap: 12px;
    page-break-after: avoid;
  }

  .vuln-card-title {
    font-size: 12pt;
    font-weight: 600;
    color: #000000;
    flex: 1;
    line-height: 1.4;
  }

  .vuln-card-body { padding: 18px 18px; line-height: 1.7; }

  .vuln-meta {
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
    margin-bottom: 14px;
  }

  .vuln-meta-item {
    display: flex;
    flex-direction: column;
    gap: 2px;
  }

  .vuln-meta-label {
    font-size: 8pt;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .vuln-meta-value {
    font-size: 10pt;
    color: var(--text);
    font-weight: 500;
  }

  .vuln-section { margin-top: 16px; page-break-inside: avoid; }

  .vuln-section-label {
    font-size: 9pt;
    color: #0066cc;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 6px;
  }

  .code-block {
    background: #f0f0f0;
    border: 1px solid var(--border);
    border-radius: 4px;
    padding: 14px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 8pt;
    line-height: 1.5;
    color: #0d5c2a;
    overflow-wrap: break-word;
    white-space: pre-wrap;
    word-break: break-all;
    page-break-inside: avoid;
  }

  .stats-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 14px;
    margin-bottom: 36px;
    page-break-inside: avoid;
  }
  }

  .stat-box {
    background: #f5f5f5;
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 18px 14px;
    text-align: center;
  }

  .stat-box-num {
    font-size: 24pt;
    font-weight: 700;
    line-height: 1;
    margin-bottom: 4px;
  }

  .stat-box-label {
    font-size: 8pt;
    color: var(--muted);
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .color-critical { color: #d1242f; }
  .color-high { color: #ff6b35; }
  .color-medium { color: #ffa500; }
  .color-low { color: #0066cc; }
  .color-info { color: #666666; }

  /* Page header (footer) */
  @page {
    size: A4;
    margin: 50px 60px;
    @bottom-center {
      content: counter(page) " / " counter(pages);
      font-size: 9pt;
      color: #999999;
      margin-top: 20px;
    }
    @top-right {
      font-size: 9pt;
      color: #999999;
    }
  }

  @page:first {
    margin: 0;
  }
</style>
</head>
<body>

<!-- COVER PAGE -->
<div class="cover">
  <div class="cover-confidential">CONFIDENCIAL</div>

  <div class="cover-accent-line"></div>
  <div class="cover-label">Relatório de Pentest</div>
  <div class="cover-title">{{ report.title }}</div>
  <div class="cover-client">{{ report.client.name }}</div>

  {% if report.overall_risk %}
  <div class="mb-4">
    <span class="cover-risk-badge risk-{{ report.overall_risk|lower }}">
      Risco {{ report.overall_risk }}<br>
      {{ counts[report.overall_risk] }} Vulnerabilidades<br>
    </span>
  </div>
  {% endif %}

  <div class="cover-meta">
    <div class="cover-meta-item">
      <span class="cover-meta-label">Tipo de Teste</span>
      <span class="cover-meta-value">{{ report.report_type }}</span>
    </div>
    <div class="cover-meta-item">
      <span class="cover-meta-label">Pentester</span>
      <span class="cover-meta-value">{{ report.author.full_name }}</span>
    </div>
    {% if report.start_date %}
    <div class="cover-meta-item">
      <span class="cover-meta-label">Período</span>
      <span class="cover-meta-value">
        {{ report.start_date.strftime('%d/%m/%Y') }}
        {% if report.end_date %} — {{ report.end_date.strftime('%d/%m/%Y') }}{% endif %}
      </span>
    </div>
    {% endif %}
    <div class="cover-meta-item">
      <span class="cover-meta-label">Versão</span>
      <span class="cover-meta-value">{{ report.version }}</span>
    </div>
    <div class="cover-meta-item">
      <span class="cover-meta-label">Data</span>
      <span class="cover-meta-value">{{ report.created_at.strftime('%d/%m/%Y') }}</span>
    </div>
    <div class="cover-meta-item">
      <span class="cover-meta-label">Status</span>
      <span class="cover-meta-value">{{ report.status }}</span>
    </div>
  </div>
</div>

<!-- EXECUTIVE SUMMARY -->
{% if report.executive_summary %}
<div class="page">
  <div class="section-title">
    <div class="section-accent"></div>
    Resumo Executivo
  </div>
  <p style="white-space:pre-wrap">{{ report.executive_summary }}</p>
</div>
{% endif %}

<!-- FINDINGS OVERVIEW -->
<div class="page">
  <div class="section-title">
    <div class="section-accent"></div>
    Visão Geral das Vulnerabilidades
  </div>

  <div class="stats-grid">
    <div class="stat-box">
      <div class="stat-box-num color-critical">{{ counts.Critical }}</div>
      <div class="stat-box-label">Critical</div>
    </div>
    <div class="stat-box">
      <div class="stat-box-num color-high">{{ counts.High }}</div>
      <div class="stat-box-label">High</div>
    </div>
    <div class="stat-box">
      <div class="stat-box-num color-medium">{{ counts.Medium }}</div>
      <div class="stat-box-label">Medium</div>
    </div>
    <div class="stat-box">
      <div class="stat-box-num color-low">{{ counts.Low }}</div>
      <div class="stat-box-label">Low</div>
    </div>
    <div class="stat-box">
      <div class="stat-box-num color-info">{{ counts.Informational }}</div>
      <div class="stat-box-label">Info</div>
    </div>
  </div>

  <table class="findings-table">
    <thead>
      <tr>
        <th>#</th>
        <th>Título</th>
        <th>Severidade</th>
        <th>CVSS</th>
        <th>Componente</th>
        <th>Status</th>
      </tr>
    </thead>
    <tbody>
      {% for vuln in vulns %}
      <tr>
        <td class="text-muted">{{ loop.index }}</td>
        <td>{{ vuln.title }}</td>
        <td>
          <span class="badge badge-{{ vuln.severity|lower }}">{{ vuln.severity }}</span>
        </td>
        <td>{{ '%.1f'|format(vuln.cvss_score) if vuln.cvss_score else '—' }}</td>
        <td class="text-muted">{{ vuln.affected_component or '—' }}</td>
        <td>
          <span class="badge badge-{{ 'remediated' if vuln.status == 'Remediated' else 'accepted' if 'Accepted' in vuln.status else 'fp' if 'False' in vuln.status else 'open' }}">
            {{ vuln.status }}
          </span>
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  {% if report.scope %}
  <h2>Escopo</h2>
  <p style="white-space:pre-wrap">{{ report.scope }}</p>
  {% endif %}

  {% if report.methodology %}
  <h2>Metodologia</h2>
  <p style="white-space:pre-wrap">{{ report.methodology }}</p>
  {% endif %}
</div>

<!-- DETAILED FINDINGS -->
{% if vulns %}
<div class="page">
  <div class="section-title">
    <div class="section-accent"></div>
    Vulnerabilidades Detalhadas
  </div>

  {% for vuln in vulns %}
  <div class="vuln-card">
    <div class="vuln-card-header">
      <div class="vuln-card-title">{{ loop.index }}. {{ vuln.title }}</div>
      <div style="display:flex;gap:8px;align-items:center;flex-shrink:0">
        <span class="badge badge-{{ vuln.severity|lower }}">{{ vuln.severity }}</span>
        <span class="badge badge-{{ 'remediated' if vuln.status == 'Remediated' else 'accepted' if 'Accepted' in vuln.status else 'fp' if 'False' in vuln.status else 'open' }}">
          {{ vuln.status }}
        </span>
      </div>
    </div>
    <div class="vuln-card-body">
      <div class="vuln-meta">
        {% if vuln.cvss_score %}
        <div class="vuln-meta-item">
          <span class="vuln-meta-label">CVSS Score</span>
          <span class="vuln-meta-value">{{ '%.1f'|format(vuln.cvss_score) }}</span>
        </div>
        {% endif %}
        {% if vuln.cve_id %}
        <div class="vuln-meta-item">
          <span class="vuln-meta-label">CVE</span>
          <span class="vuln-meta-value">{{ vuln.cve_id }}</span>
        </div>
        {% endif %}
        {% if vuln.affected_component %}
        <div class="vuln-meta-item">
          <span class="vuln-meta-label">Componente</span>
          <span class="vuln-meta-value">{{ vuln.affected_component }}</span>
        </div>
        {% endif %}
      </div>

      {% if vuln.cvss_vector %}
      <div class="vuln-section">
        <div class="vuln-section-label">CVSS Vector</div>
        <code>{{ vuln.cvss_vector }}</code>
      </div>
      {% endif %}

      {% if vuln.description %}
      <div class="vuln-section">
        <div class="vuln-section-label">Descrição</div>
        <p style="white-space:pre-wrap;margin:0">{{ vuln.description }}</p>
      </div>
      {% endif %}

      {% if vuln.proof_of_concept %}
      <div class="vuln-section">
        <div class="vuln-section-label">Prova de Conceito</div>
        <div class="code-block">{{ vuln.proof_of_concept }}</div>
      </div>
      {% endif %}

      {% if vuln.impact %}
      <div class="vuln-section">
        <div class="vuln-section-label">Impacto</div>
        <p style="white-space:pre-wrap;margin:0">{{ vuln.impact }}</p>
      </div>
      {% endif %}

      {% if vuln.recommendation %}
      <div class="vuln-section">
        <div class="vuln-section-label" style="color:#3fb950">Recomendação</div>
        <p style="white-space:pre-wrap;margin:0">{{ vuln.recommendation }}</p>
      </div>
      {% endif %}

      {% if vuln.references %}
      <div class="vuln-section">
        <div class="vuln-section-label">Referências</div>
        <p style="white-space:pre-wrap;margin:0;font-size:9pt">{{ vuln.references }}</p>
      </div>
      {% endif %}
    </div>
  </div>
  {% endfor %}
</div>
{% endif %}

<!-- CONCLUSION -->
{% if report.conclusion %}
<div class="page">
  <div class="section-title">
    <div class="section-accent"></div>
    Conclusão
  </div>
  <p style="white-space:pre-wrap">{{ report.conclusion }}</p>
</div>
{% endif %}

</body>
</html>
